# –°–î–≠–ö: –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –±–ª–æ—á–Ω–æ–≥–æ checkout

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—è –°–î–≠–ö –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–ª–æ—á–Ω–æ–π —Ñ–æ—Ä–º–µ WooCommerce checkout.

## üìÅ –§–∞–π–ª—ã —Ä–µ—à–µ–Ω–∏—è

### 1. `cdek-force-fields.php` - –û—Å–Ω–æ–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∏—Ö.

### 2. `cdek-test-fields.php` - –¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫ 
–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –ø–æ–ª–µ–π.

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
```php
// –í functions.php –≤–∞—à–µ–π —Ç–µ–º—ã –¥–æ–±–∞–≤—å—Ç–µ:
require_once get_template_directory() . '/cdek-force-fields.php';
require_once get_template_directory() . '/cdek-test-fields.php'; // –í—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É checkout
2. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –ø–æ—è–≤–∏—Ç—Å—è –ø–∞–Ω–µ–ª—å "üß™ –°–î–≠–ö –¢–µ—Å—Ç–µ—Ä"
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîÑ –¢–µ—Å—Ç" –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –í –ø–∞–Ω–µ–ª–∏ —Ç–µ—Å—Ç–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- ‚úÖ **–ü–æ–ª—è –Ω–∞–π–¥–µ–Ω—ã!** (–∑–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç)
- üéØ **–°–î–≠–ö –ø–æ–ª–µ–π: 4**
- üöö **–ë–ª–æ–∫–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏: 1+**

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
cdekDebug() // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏:
```
üöÄ –°–î–≠–ö: –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π
‚úÖ –°–î–≠–ö: –ü–æ–ª—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ form.wc-block-components-form (—Ç–µ–≥: FORM)
üîß –°–î–≠–ö: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–µ–π - –ø–æ name: 4, –ø–æ –∞—Ç—Ä–∏–±—É—Ç—É: 4
```

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ü–í–ó:
```
‚úÖ –°–î–≠–ö: –ü–æ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º .wc-block-components-totals-item
üìç –ù–∞–∑–≤–∞–Ω–∏–µ: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —É–ª. –ü—É–¥–æ–∂—Å–∫–∞—è
üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: 350
üìÆ –ê–¥—Ä–µ—Å: 197110, –†–æ—Å—Å–∏—è, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —É–ª. –ü—É–¥–æ–∂—Å–∫–∞—è, 4 –ª–∏—Ç. –ê
```

## üõ†Ô∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ

### 1. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞ —Ñ–æ—Ä–º—ã
–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–±—É–µ—Ç –Ω–∞–π—Ç–∏ —Ñ–æ—Ä–º—É –ø–æ —Ä–∞–∑–Ω—ã–º —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º:
- `form.wc-block-components-form`
- `form.woocommerce-checkout`
- `.wc-block-checkout__form`
- `form[name="checkout"]`
- –ò –¥—Ä—É–≥–∏–µ fallback –≤–∞—Ä–∏–∞–Ω—Ç—ã

### 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è –ø–æ–ª–µ–π
- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –î–æ–±–∞–≤–ª—è–µ—Ç 4 —Å–∫—Ä—ã—Ç—ã—Ö –ø–æ–ª—è —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º `data-cdek="field"`
- –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —á–µ—Ä–µ–∑ 1, 3 –∏ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –±–ª–æ–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ—Å—Ç–∞–≤–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞

### 4. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ–ø–∞–¥–∞–Ω–∏—è –ø–æ–ª–µ–π
- MutationObserver –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è DOM
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–ª—è –µ—Å–ª–∏ –æ–Ω–∏ –∏—Å—á–µ–∑–∞—é—Ç
- –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ localStorage –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∑–∞–∫–∞–∑
```php
function cdek_save_force_fields($order_id) {
    $fields = array(
        'cdek_point_name' => '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞',
        'cdek_point_address' => '–ê–¥—Ä–µ—Å –ø—É–Ω–∫—Ç–∞', 
        'cdek_point_cost' => '–°—Ç–æ–∏–º–æ—Å—Ç—å',
        'cdek_point_code' => '–ö–æ–¥ –ø—É–Ω–∫—Ç–∞'
    );
    
    foreach ($fields as $field => $label) {
        if (isset($_POST[$field]) && !empty($_POST[$field])) {
            $value = sanitize_text_field($_POST[$field]);
            update_post_meta($order_id, $field, $value);
        }
    }
}
```

## üìß –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ email –∏ –∞–¥–º–∏–Ω–∫–µ

### –í –∞–¥–º–∏–Ω–∫–µ –∑–∞–∫–∞–∑–∞:
–ü–æ—è–≤–∏—Ç—Å—è –∑–µ–ª–µ–Ω—ã–π –±–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–æ—Å—Ç–∞–≤–∫–µ –°–î–≠–ö.

### –í email:
–î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ "–î–æ—Å—Ç–∞–≤–∫–∞ –°–î–≠–ö" —Å –ø–æ–ª–Ω—ã–º –∞–¥—Ä–µ—Å–æ–º –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é.

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—è –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
1. jQuery –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
2. –ù–µ—Ç JavaScript –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
3. –§–∞–π–ª `cdek-force-fields.php` –ø–æ–¥–∫–ª—é—á–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ –ø—É—Å—Ç—ã–µ
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
1. –í HTML –µ—Å—Ç—å –±–ª–æ–∫–∏ —Å –∫–ª–∞—Å—Å–æ–º `.wc-block-components-totals-item`
2. –í —ç—Ç–∏—Ö –±–ª–æ–∫–∞—Ö –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å (–Ω–µ "–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏")
3. –ê–¥—Ä–µ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: —É–ª., –ø—Ä-—Ç, –ø–µ—Ä. –∏–ª–∏ –∑–∞–ø—è—Ç—É—é

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∑–∞–∫–∞–∑
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```php
error_log('–°–î–≠–ö FORCE: $_POST –¥–∞–Ω–Ω—ã–µ: ' . print_r(array_keys($_POST), true));
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–Ω–µ–ª—å —Ç–µ—Å—Ç–µ—Ä–∞
–ù–∞–∂–º–∏—Ç–µ "üîÑ –¢–µ—Å—Ç" –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–Ω—Å–æ–ª–∏.

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä—É—á–Ω—É—é –∏–Ω—ä–µ–∫—Ü–∏—é
–í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
$('body').append('<input type="hidden" name="test_field" value="test">');
console.log('–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ:', $('input[name="test_field"]').length);
```

### 3. –°–∏–º—É–ª—è—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ü–í–ó
–í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
// –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ü–í–ó
$('input[name="cdek_point_name"]').val('–¢–µ—Å—Ç, —É–ª. –¢–µ—Å—Ç–æ–≤–∞—è');
$('input[name="cdek_point_cost"]').val('350');
console.log('–î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
```

## üî• –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –º–µ—Ä—ã

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü `functions.php`:
```php
add_action('wp_footer', function() {
    if (!is_checkout()) return;
    ?>
    <script>
    jQuery(function($) {
        // –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(function() {
            if ($('input[name="cdek_point_name"]').length === 0) {
                $('body').append('<input type="hidden" name="cdek_point_name" value="">');
                $('body').append('<input type="hidden" name="cdek_point_address" value="">');
                $('body').append('<input type="hidden" name="cdek_point_cost" value="">');
                $('body').append('<input type="hidden" name="cdek_point_code" value="">');
                console.log('üÜò –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è –ø–æ–ª–µ–π –°–î–≠–ö');
            }
        }, 2000);
    });
    </script>
    <?php
});
```

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

1. ‚úÖ –ü–æ–ª—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ DOM
2. ‚úÖ –ü–æ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ü–í–ó
3. ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∑–∞–∫–∞–∑ (`get_post_meta`)
4. ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ –∑–∞–∫–∞–∑–∞
5. ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ email

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–¥–∞–ª–∏—Ç–µ `cdek-test-fields.php` –∏–∑ `functions.php`.