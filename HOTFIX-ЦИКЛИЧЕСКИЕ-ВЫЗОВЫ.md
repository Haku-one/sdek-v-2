# –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –≤—ã–∑–æ–≤—ã API

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–§—É–Ω–∫—Ü–∏—è `updateCheckoutFieldsForBlocksAPI()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –∏ —Å–æ–∑–¥–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:
- –¢—ã—Å—è—á–∞–º –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- –ó–∞–º–µ–¥–ª–µ–Ω–∏—é —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞
- –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ `assets/js/textarea-auto-fill.js`

–ù–∞–π—Ç–∏ –∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å/–∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏:

#### 1. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ (—Å—Ç—Ä–æ–∫–∞ ~862):
```javascript
// –ë–´–õ–û:
setInterval(forceUpdateCheckoutFields, 2000);

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
// setInterval(forceUpdateCheckoutFields, 2000); // –û–¢–ö–õ–Æ–ß–ï–ù–û - —Å–æ–∑–¥–∞–µ—Ç —Ü–∏–∫–ª—ã
```

#### 2. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ wp.data.subscribe (—Å—Ç—Ä–æ–∫–∞ ~850):
```javascript
// –ë–´–õ–û:
const unsubscribe = window.wp.data.subscribe(() => {
    updateCheckoutFieldsForBlocksAPI();
});

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
// –ü–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ - —Å–æ–∑–¥–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
// const unsubscribe = window.wp.data.subscribe(() => {
//     updateCheckoutFieldsForBlocksAPI();
// });
```

#### 3. –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –≤ —Å–æ–±—ã—Ç–∏—è—Ö:
```javascript
// –ë–´–õ–û:
$(document.body).on('update_checkout', function() {
    updateCheckoutFieldsForBlocksAPI();
});

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
$(document.body).on('update_checkout', function() {
    debouncedAPIUpdate(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–±–∞—É–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
});
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —á–∞—Å—Ç—ã—Ö –≤—ã–∑–æ–≤–æ–≤

–í —Ñ—É–Ω–∫—Ü–∏—é `updateCheckoutFieldsForBlocksAPI()` –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ:

```javascript
function updateCheckoutFieldsForBlocksAPI() {
    // –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã—Ö –≤—ã–∑–æ–≤–æ–≤ (–Ω–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ —Å–µ–∫—É–Ω–¥—É)
    const now = Date.now();
    if (now - lastAPIUpdateTime < 1000) {
        console.log('üïê API –≤—ã–∑–æ–≤ –ø—Ä–æ–ø—É—â–µ–Ω - —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ –¥–∞–Ω–Ω—ã–µ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—ã–∑–æ–≤–∞
    const currentData = { 
        dostavka: window.currentDeliveryData?.dostavka || '',
        manager: window.currentDeliveryData?.manager || ''
    };
    
    if (JSON.stringify(currentData) === JSON.stringify(lastAPIUpdateData)) {
        console.log('‚ÑπÔ∏è API –≤—ã–∑–æ–≤ –ø—Ä–æ–ø—É—â–µ–Ω - –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å');
        return;
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏
}
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—è

–í –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –¥–æ–±–∞–≤–∏—Ç—å:
```javascript
// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —á–∞—Å—Ç–æ—Ç—ã –≤—ã–∑–æ–≤–æ–≤ API
let lastAPIUpdateTime = 0;
let lastAPIUpdateData = { dostavka: '', manager: '' };
let apiUpdateTimeout;
```

### –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–±–∞—É–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é

–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `updateCheckoutFieldsForBlocksAPI()` –Ω–∞ `debouncedAPIUpdate()`:

```javascript
// –î–µ–±–∞—É–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ API –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
function debouncedAPIUpdate() {
    clearTimeout(apiUpdateTimeout);
    apiUpdateTimeout = setTimeout(updateCheckoutFieldsForBlocksAPI, 500);
}
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
- `üïê API –≤—ã–∑–æ–≤ –ø—Ä–æ–ø—É—â–µ–Ω - —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ`
- `‚ÑπÔ∏è API –≤—ã–∑–æ–≤ –ø—Ä–æ–ø—É—â–µ–Ω - –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å`

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

## üìã –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è

–°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: `assets/js/textarea-auto-fill-backup.js`

## ‚ö° –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å setInterval
2. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å wp.data.subscribe  
3. –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ updateCheckoutFieldsForBlocksAPI() –Ω–∞ debouncedAPIUpdate()

–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –±–µ–∑ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –≤—ã–∑–æ–≤–æ–≤ API.