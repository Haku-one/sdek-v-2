# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Email –®–∞–±–ª–æ–Ω–æ–≤ –°–î–≠–ö –≤ –¢–µ–º—É

## –û–ø–∏—Å–∞–Ω–∏–µ

–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –°–î–≠–ö (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ email, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø—Ü–∏–∏ "–û–±—Å—É–¥–∏—Ç—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º") –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ email —à–∞–±–ª–æ–Ω—ã –≤ –≤–∞—à—É —Ç–µ–º—É WordPress.

## ‚ö†Ô∏è –ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ?

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–ª–∞–≥–∏–Ω –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –≤ —Ç–µ–º–µ.

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –≤ –≤–∞—à–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–µ–º–µ:
```
/wp-content/themes/–≤–∞—à–∞-—Ç–µ–º–∞/woocommerce/emails/
```

### –®–∞–≥ 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ `/woocommerce-email-templates/` –≤ –ø–∞–ø–∫—É —Ç–µ–º—ã:

1. **admin-new-order.php** ‚Üí `/wp-content/themes/–≤–∞—à–∞-—Ç–µ–º–∞/woocommerce/emails/admin-new-order.php`
2. **customer-completed-order.php** ‚Üí `/wp-content/themes/–≤–∞—à–∞-—Ç–µ–º–∞/woocommerce/emails/customer-completed-order.php`

### –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –≤ functions.php

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `functions.php` –≤–∞—à–µ–π —Ç–µ–º—ã —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

```php
<?php
/**
 * –°–î–≠–ö –î–æ—Å—Ç–∞–≤–∫–∞ - –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ–º—ã
 */

// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
if (!defined('ABSPATH')) {
    exit;
}

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –°–î–≠–ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ç–µ–º—ã
 */
function cdek_theme_init() {
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –°–î–≠–ö —à–∞–±–ª–æ–Ω–æ–≤ email
    add_action('init', 'cdek_setup_email_templates');
    
    // –•—É–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ—Å—Ç–∞–≤–∫–µ –≤ –∞–¥–º–∏–Ω–∫–µ –∑–∞–∫–∞–∑–∞
    add_action('woocommerce_admin_order_data_after_shipping_address', 'cdek_display_delivery_info_in_admin', 20);
    
    // –•—É–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    add_action('woocommerce_checkout_update_order_meta', 'cdek_save_additional_delivery_meta', 20);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª "–û–±—Å—É–¥–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"
    add_action('woocommerce_checkout_update_order_meta', 'cdek_save_discuss_delivery_choice', 25);
    add_action('woocommerce_admin_order_data_after_shipping_address', 'cdek_show_discuss_delivery_admin', 25);
    add_action('woocommerce_email_order_details', 'cdek_email_discuss_delivery_info', 30, 4);
}
add_action('after_setup_theme', 'cdek_theme_init');

/**
 * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ email
 */
function cdek_setup_email_templates() {
    if (!class_exists('WooCommerce')) {
        return;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç–∞–≤–∫–µ –≤ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ö—É–∫–∏
    add_action('woocommerce_email_order_details', 'cdek_add_delivery_info_to_any_email', 25, 4);
}

/**
 * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ "–û–±—Å—É–¥–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"
 */
function cdek_save_discuss_delivery_choice($order_id) {
    error_log('–°–î–≠–ö DEBUG: –§—É–Ω–∫—Ü–∏—è cdek_save_discuss_delivery_choice –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞ #' . $order_id);
    error_log('–°–î–≠–ö DEBUG: $_POST –¥–∞–Ω–Ω—ã–µ: ' . print_r($_POST, true));
    
    if (isset($_POST['discuss_delivery_selected'])) {
        error_log('–°–î–≠–ö DEBUG: –ü–æ–ª–µ discuss_delivery_selected –Ω–∞–π–¥–µ–Ω–æ –≤ $_POST —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º: ' . $_POST['discuss_delivery_selected']);
        
        if ($_POST['discuss_delivery_selected'] == '1') {
            update_post_meta($order_id, '_discuss_delivery_selected', '–î–∞');
            error_log('–°–î–≠–ö DEBUG: –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –º–µ—Ç–∞ –ø–æ–ª–µ _discuss_delivery_selected –∑–Ω–∞—á–µ–Ω–∏–µ "–î–∞"');
            
            $order = wc_get_order($order_id);
            if ($order) {
                $order->add_order_note('–ö–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª "–û–±—Å—É–¥–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"');
                error_log('–°–î–≠–ö: –°–æ—Ö—Ä–∞–Ω–µ–Ω –≤—ã–±–æ—Ä "–û–±—Å—É–¥–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º" –¥–ª—è –∑–∞–∫–∞–∑–∞ #' . $order_id);
            }
        } else {
            error_log('–°–î–≠–ö DEBUG: –ó–Ω–∞—á–µ–Ω–∏–µ discuss_delivery_selected –Ω–µ —Ä–∞–≤–Ω–æ "1": ' . $_POST['discuss_delivery_selected']);
        }
    } else {
        error_log('–°–î–≠–ö DEBUG: –ü–æ–ª–µ discuss_delivery_selected –ù–ï –Ω–∞–π–¥–µ–Ω–æ –≤ $_POST');
        error_log('–°–î–≠–ö DEBUG: –î–æ—Å—Ç—É–ø–Ω—ã–µ POST –ø–æ–ª—è: ' . implode(', ', array_keys($_POST)));
    }
}

/**
 * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—Å—É–∂–¥–µ–Ω–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ –∑–∞–∫–∞–∑–∞
 */
function cdek_show_discuss_delivery_admin($order) {
    if (get_post_meta($order->get_id(), '_discuss_delivery_selected', true) == '–î–∞') {
        ?>
        <div style="background: #ffeb3b; border: 2px solid #ff9800; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h4 style="color: #e65100; margin: 0; font-size: 16px; display: flex; align-items: center;">
                <span style="font-size: 20px; margin-right: 8px;">üó£Ô∏è</span>
                –û–ë–°–£–î–ò–¢–¨ –î–û–°–¢–ê–í–ö–£ –° –ú–ï–ù–ï–î–ñ–ï–†–û–ú
            </h4>
            <p style="color: #e65100; font-weight: bold; margin: 8px 0 0 0; font-size: 14px;">
                ‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏!
            </p>
            <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 4px;">
                <small style="color: #bf360c; font-weight: bold;">
                    üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: —É—Ç–æ—á–Ω–∏—Ç—å –∞–¥—Ä–µ—Å, –≤—Ä–µ–º—è, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏
                </small>
            </div>
        </div>
        <?php
    }
}

/**
 * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—Å—É–∂–¥–µ–Ω–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
 */
function cdek_email_discuss_delivery_info($order, $sent_to_admin, $plain_text, $email) {
    if (get_post_meta($order->get_id(), '_discuss_delivery_selected', true) == '–î–∞') {
        if ($plain_text) {
            echo "\n" . str_repeat('=', 50) . "\n";
            echo "–î–û–°–¢–ê–í–ö–ê: –û–±—Å—É–∂–¥–∞–µ—Ç—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º\n";
            echo str_repeat('=', 50) . "\n";
            
            if ($sent_to_admin) {
                echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏!\n";
                echo "–£—Ç–æ—á–Ω–∏—Ç–µ: –∞–¥—Ä–µ—Å, –≤—Ä–µ–º—è, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏.\n";
            } else {
                echo "–ù–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏.\n";
                echo "–û–∂–∏–¥–∞–π—Ç–µ –∑–≤–æ–Ω–∫–∞ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.\n";
            }
            echo "\n";
        } else {
            // HTML –≤–µ—Ä—Å–∏–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
        }
    }
}
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É** WordPress
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –∂—É—Ä–Ω–∞–ª –æ—à–∏–±–æ–∫** (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω WP_DEBUG)
3. **–ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:** `"–°–î–≠–ö: –ù–∞–π–¥–µ–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –≤ —Ç–µ–º–µ, —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Ç–∫–ª—é—á–µ–Ω"`

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –í Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö:
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É:** –∫—Ä–∞—Å–∏–≤—ã–π –±–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–æ—Å—Ç–∞–≤–∫–µ –°–î–≠–ö
- **–ö–ª–∏–µ–Ω—Ç—É:** –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—É–Ω–∫—Ç–µ –≤—ã–¥–∞—á–∏
- **–ü—Ä–∏ –≤—ã–±–æ—Ä–µ "–û–±—Å—É–¥–∏—Ç—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º":** —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

### –í –∞–¥–º–∏–Ω–∫–µ –∑–∞–∫–∞–∑–∞:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—É–Ω–∫—Ç–µ –≤—ã–¥–∞—á–∏ –°–î–≠–ö
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ "–û–±—Å—É–¥–∏—Ç—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"
- –ó–∞–º–µ—Ç–∫–∏ –≤ –∑–∞–∫–∞–∑–µ –æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ —Ç–µ–º—É, –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω –∫–∞–∫ –µ—Å—Ç—å - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.

## üêû –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ–±–∞–≤—å—Ç–µ –≤ `wp-config.php`:

```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
```

–õ–æ–≥–∏ –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –≤ `/wp-content/debug.log`

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –í–µ—Ä—Å–∏—é WooCommerce (–º–∏–Ω–∏–º—É–º 8.0)
2. –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–ª–∞–≥–∏–Ω–∞ –°–î–≠–ö –î–æ—Å—Ç–∞–≤–∫–∞
3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º —Ç–µ–º—ã
4. –ñ—É—Ä–Ω–∞–ª –æ—à–∏–±–æ–∫ WordPress

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ —à–∞–±–ª–æ–Ω—ã email. –í —Å–ª—É—á–∞–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —à–∞–≥–∏ 2-3.