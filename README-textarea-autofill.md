# Автозаполнение textarea полей для доставки

## Описание
Реализовано автоматическое заполнение скрытых textarea полей в зависимости от выбранного способа доставки:
- При выборе "Доставка с менеджером" → заполняется поле менеджера текстом "Доставка менеджером"
- При выборе СДЭК → заполняется поле СДЭК с информацией о выбранном варианте, цене и пункте выдачи

## Структура полей
Используются существующие textarea поля с классами:
```html
<div class="wp-block-checkout-fields-for-blocks-textarea sdek">
    <label for="87421bf6-0900-47cb-8c83-228d9681b97c">Доставка</label>
    <textarea class="wc-block-components-textarea" placeholder="Сдэк" rows="2"></textarea>
</div>

<div class="wp-block-checkout-fields-for-blocks-textarea manag">
    <label for="87421bf6-0900-47cb-8c83-228d9681b97c">Менеджер</label>
    <textarea class="wc-block-components-textarea" placeholder="Обсудить доставку с менеджером" rows="2"></textarea>
</div>
```

## Как это работает

### Автозаполнение полей
1. JavaScript отслеживает изменения в методах доставки
2. При выборе "Обсудить доставку с менеджером":
   - Очищается поле СДЭК
   - Заполняется поле менеджера текстом "Доставка менеджером"

3. При выборе СДЭК доставки:
   - Очищается поле менеджера
   - Заполняется поле СДЭК информацией:
     - Название способа доставки
     - Цена доставки
     - Информация о выбранном пункте выдачи (если есть)

### Пример заполнения поля СДЭК
```
СДЭК Доставка до пункта выдачи - 250 руб.
Пункт выдачи: СДЭК на Невском
Адрес: г. Санкт-Петербург, Невский пр-т, 100
```

## Отображение данных

### В админке заказов
Информация отображается в блоке "Информация о доставке" с поддержкой переносов строк.

### В email уведомлениях
Добавляется блок "Информация о доставке" с полной информацией из textarea полей.

## Технические детали

### Файлы
- `textarea-auto-fill.js` - JavaScript для автозаполнения textarea полей
- `cdek-delivery-styles.css` - CSS стили (поля скрыты через opacity: 0; height: 0;)
- Обновлена функциональность в `cdek-delivery-plugin.php`

### Хуки и функции
- `save_delivery_manager_field()` - сохранение данных из textarea полей
- `display_delivery_manager_in_admin()` - отображение в админке
- `add_delivery_manager_to_emails()` - добавление в emails

### Мета поля в базе данных
- `_delivery_manager_textarea` - данные из поля менеджера
- `_cdek_delivery_textarea` - данные из поля СДЭК

## JavaScript функции
- `fillTextareaFields()` - заполнение полей в зависимости от типа доставки
- `getCurrentDeliveryType()` - определение текущего типа доставки
- `getDeliveryInfo()` - получение информации о доставке из блока
- `updateTextareaFields()` - основная функция обновления полей

## События отслеживания
- Изменения в радиокнопках методов доставки
- Клики по вкладкам доставки
- Обновления чекаута
- Изменения в блоке доставки (MutationObserver)
- Изменения в localStorage

## Отладка
Для отладки можно посмотреть:
1. Консоль браузера - логи JavaScript с эмодзи для удобства
2. Глобальные функции для тестирования: `window.updateTextareaFields()`, `window.fillTextareaFields()`
3. Мета поля заказа в админке WordPress

## Совместимость
- WooCommerce 8.0+
- WordPress 5.0+
- Работает с блочным чекаутом
- Требует jQuery

## Удаленные компоненты
- Удален файл `delivery-tracker.js` (больше не нужен)
- Удалены лишние скрытые поля ACF
- Упрощена логика сохранения и отображения данных