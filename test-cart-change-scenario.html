<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .scenario { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .step { margin: 15px 0; padding: 15px; border-left: 4px solid #007cba; background: #f8f9fa; }
        .step-title { font-weight: bold; color: #007cba; margin-bottom: 10px; }
        .step-status { margin: 10px 0; padding: 8px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .cart-state { background: #e9ecef; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; }
        .action-button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .action-button:hover { background: #005a8c; }
        .log { background: #f8f9fa; padding: 15px; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 12px; margin: 15px 0; border: 1px solid #dee2e6; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –°–î–≠–ö</h1>
    
    <div class="scenario">
        <h2>üìã –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è</h2>
        <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–æ—Ä–º–∏–ª –∑–∞–∫–∞–∑ —Å–æ –°–î–≠–ö, –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ —Ö–æ—á–µ—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å "–æ–±—Å—É–∂–¥–µ–Ω–∏–µ–º —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º". –û—á–∏—â–∞—é—Ç—Å—è –ª–∏ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö?</p>
        
        <div class="step">
            <div class="step-title">–®–∞–≥ 1: –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</div>
            <div class="cart-state" id="initial-state">
                –ö–æ—Ä–∑–∏–Ω–∞: 2 —Ç–æ–≤–∞—Ä–∞, —Å—É–º–º–∞ 500 —Ä—É–±.
                –°–î–≠–ö: –Ω–µ –≤—ã–±—Ä–∞–Ω
                Hash –∫–æ—Ä–∑–∏–Ω—ã: cart_hash_1
            </div>
        </div>
        
        <div class="step">
            <div class="step-title">–®–∞–≥ 2: –í—ã–±–æ—Ä –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫–∏</div>
            <button class="action-button" onclick="selectCdekDelivery()">üöö –í—ã–±—Ä–∞—Ç—å –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫—É</button>
            <div class="step-status" id="step2-status"></div>
        </div>
        
        <div class="step">
            <div class="step-title">–®–∞–≥ 3: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ 1 (—Å–∏–º—É–ª—è—Ü–∏—è)</div>
            <button class="action-button" onclick="completeOrder1()">‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ 1</button>
            <div class="step-status" id="step3-status"></div>
        </div>
        
        <div class="step">
            <div class="step-title">–®–∞–≥ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</div>
            <button class="action-button" onclick="addNewItems()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã</button>
            <div class="step-status" id="step4-status"></div>
        </div>
        
        <div class="step">
            <div class="step-title">–®–∞–≥ 5: –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–±—Ä–∞—Ç—å "–û–±—Å—É–¥–∏—Ç—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"</div>
            <button class="action-button" onclick="selectManagerDiscussion()">üìû –í—ã–±—Ä–∞—Ç—å "–û–±—Å—É–¥–∏—Ç—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"</button>
            <div class="step-status" id="step5-status"></div>
        </div>
    </div>
    
    <div class="scenario">
        <h3>üîç –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h3>
        <div id="current-state" class="cart-state">
            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
        </div>
        
        <h3>üìä –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
        <div id="operation-log" class="log"></div>
        
        <button class="action-button" onclick="resetScenario()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π</button>
    </div>

    <script>
        // –°–∏–º—É–ª—è—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
        let systemState = {
            cartItems: ['–¢–æ–≤–∞—Ä 1', '–¢–æ–≤–∞—Ä 2'],
            cartTotal: 500,
            cartHash: 'cart_hash_1',
            cdekDeliveryType: null,
            cdekPointCode: null,
            cdekDeliveryCost: 0,
            lastSavedCartHash: null,
            orderCount: 0
        };
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('operation-log');
            const typeIcon = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            }[type] || '‚ÑπÔ∏è';
            
            logDiv.innerHTML += `[${timestamp}] ${typeIcon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateCurrentState() {
            const stateDiv = document.getElementById('current-state');
            stateDiv.innerHTML = `
                <strong>–ö–æ—Ä–∑–∏–Ω–∞:</strong> ${systemState.cartItems.join(', ')} (${systemState.cartTotal} —Ä—É–±.)<br>
                <strong>Hash –∫–æ—Ä–∑–∏–Ω—ã:</strong> ${systemState.cartHash}<br>
                <strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π hash:</strong> ${systemState.lastSavedCartHash || '(–Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω)'}<br>
                <strong>–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏ –°–î–≠–ö:</strong> ${systemState.cdekDeliveryType || '(–Ω–µ –≤—ã–±—Ä–∞–Ω)'}<br>
                <strong>–ö–æ–¥ –ø—É–Ω–∫—Ç–∞ –°–î–≠–ö:</strong> ${systemState.cdekPointCode || '(–Ω–µ –≤—ã–±—Ä–∞–Ω)'}<br>
                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å –°–î–≠–ö:</strong> ${systemState.cdekDeliveryCost} —Ä—É–±.<br>
                <strong>–ó–∞–∫–∞–∑–æ–≤ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ:</strong> ${systemState.orderCount}
            `;
        }
        
        function checkIfCdekDataShouldBeCleaned() {
            // –õ–æ–≥–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∏–∑ PHP –∫–æ–¥–∞
            const cartChanged = systemState.cartHash !== systemState.lastSavedCartHash;
            const hasCdekData = systemState.cdekDeliveryType || systemState.cdekPointCode || systemState.cdekDeliveryCost > 0;
            
            if (cartChanged && hasCdekData) {
                log('üßπ –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã - –æ—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö', 'warning');
                
                // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö
                systemState.cdekDeliveryType = null;
                systemState.cdekPointCode = null;
                systemState.cdekDeliveryCost = 0;
                
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –°–î–≠–ö –æ—á–∏—â–µ–Ω—ã', 'success');
                return true;
            }
            
            return false;
        }
        
        function selectCdekDelivery() {
            log('üöö === –®–ê–ì 2: –í—ã–±–æ—Ä –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫–∏ ===');
            
            systemState.cdekDeliveryType = 'cdek';
            systemState.cdekPointCode = 'MSK123';
            systemState.cdekDeliveryCost = 366;
            systemState.lastSavedCartHash = systemState.cartHash; // –°–æ—Ö—Ä–∞–Ω—è–µ–º hash –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –°–î–≠–ö
            
            log('–í—ã–±—Ä–∞–Ω –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –°–î–≠–ö: MSK123');
            log('–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏: 366 —Ä—É–±.');
            log('–°–æ—Ö—Ä–∞–Ω–µ–Ω hash –∫–æ—Ä–∑–∏–Ω—ã: ' + systemState.cartHash);
            
            document.getElementById('step2-status').innerHTML = 
                '<div class="success">‚úÖ –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫–∞ –≤—ã–±—Ä–∞–Ω–∞ (366 —Ä—É–±.)</div>';
            
            updateCurrentState();
        }
        
        function completeOrder1() {
            log('üì¶ === –®–ê–ì 3: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ 1 ===');
            
            systemState.orderCount++;
            
            log('–ó–∞–∫–∞–∑ #' + systemState.orderCount + ' –æ—Ñ–æ—Ä–º–ª–µ–Ω —Å–æ –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫–æ–π');
            log('–î–∞–Ω–Ω—ã–µ –°–î–≠–ö –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏ (–∑–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω, –Ω–æ —Å–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞)');
            
            document.getElementById('step3-status').innerHTML = 
                '<div class="success">‚úÖ –ó–∞–∫–∞–∑ #' + systemState.orderCount + ' –æ—Ñ–æ—Ä–º–ª–µ–Ω</div>';
            
            updateCurrentState();
        }
        
        function addNewItems() {
            log('‚ûï === –®–ê–ì 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ ===');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
            systemState.cartItems.push('–¢–æ–≤–∞—Ä 3', '–¢–æ–≤–∞—Ä 4');
            systemState.cartTotal += 300;
            systemState.cartHash = 'cart_hash_2'; // –ù–æ–≤—ã–π hash –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            
            log('–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–≤–∞—Ä—ã: –¢–æ–≤–∞—Ä 3, –¢–æ–≤–∞—Ä 4');
            log('–ù–æ–≤–∞—è —Å—É–º–º–∞ –∫–æ—Ä–∑–∏–Ω—ã: ' + systemState.cartTotal + ' —Ä—É–±.');
            log('–ù–æ–≤—ã–π hash –∫–æ—Ä–∑–∏–Ω—ã: ' + systemState.cartHash);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ—á–∏—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö
            const wasCleared = checkIfCdekDataShouldBeCleaned();
            
            if (wasCleared) {
                document.getElementById('step4-status').innerHTML = 
                    '<div class="warning">‚ö†Ô∏è –¢–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã. –î–∞–Ω–Ω—ã–µ –°–î–≠–ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–µ–Ω—ã!</div>';
            } else {
                document.getElementById('step4-status').innerHTML = 
                    '<div class="error">‚ùå –¢–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã, –Ω–æ –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö –ù–ï –æ—á–∏—â–µ–Ω—ã!</div>';
            }
            
            updateCurrentState();
        }
        
        function selectManagerDiscussion() {
            log('üìû === –®–ê–ì 5: –í—ã–±–æ—Ä "–û–±—Å—É–¥–∏—Ç—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º" ===');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö
            const hadOldCdekData = systemState.cdekDeliveryType || systemState.cdekPointCode || systemState.cdekDeliveryCost > 0;
            
            if (hadOldCdekData) {
                log('‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–∞–π–¥–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö!', 'error');
                log('  - –¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏: ' + (systemState.cdekDeliveryType || '–Ω–µ—Ç'));
                log('  - –ö–æ–¥ –ø—É–Ω–∫—Ç–∞: ' + (systemState.cdekPointCode || '–Ω–µ—Ç'));
                log('  - –°—Ç–æ–∏–º–æ—Å—Ç—å: ' + systemState.cdekDeliveryCost + ' —Ä—É–±.');
                
                document.getElementById('step5-status').innerHTML = 
                    '<div class="error">‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö –Ω–µ –æ—á–∏—â–µ–Ω—ã!</div>';
            } else {
                log('‚úÖ –°—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –°–î–≠–ö –Ω–µ—Ç - –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞', 'success');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏
                systemState.cdekDeliveryType = 'manager';
                systemState.cdekDeliveryCost = 0;
                
                log('–í—ã–±—Ä–∞–Ω —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏: –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º');
                log('–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏: 0 —Ä—É–±. (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)');
                
                document.getElementById('step5-status').innerHTML = 
                    '<div class="success">‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –ú–µ–Ω–µ–¥–∂–µ—Ä –≤—ã–±—Ä–∞–Ω, –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö –æ—á–∏—â–µ–Ω—ã!</div>';
            }
            
            updateCurrentState();
        }
        
        function resetScenario() {
            log('üîÑ === –°–ë–†–û–° –°–¶–ï–ù–ê–†–ò–Ø ===');
            
            systemState = {
                cartItems: ['–¢–æ–≤–∞—Ä 1', '–¢–æ–≤–∞—Ä 2'],
                cartTotal: 500,
                cartHash: 'cart_hash_1',
                cdekDeliveryType: null,
                cdekPointCode: null,
                cdekDeliveryCost: 0,
                lastSavedCartHash: null,
                orderCount: 0
            };
            
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ç—É—Å—ã —à–∞–≥–æ–≤
            ['step2-status', 'step3-status', 'step4-status', 'step5-status'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            
            log('–°—Ü–µ–Ω–∞—Ä–∏–π —Å–±—Ä–æ—à–µ–Ω –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');
            updateCurrentState();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            log('üéØ –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω');
            log('üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:');
            log('1. –í—ã–±–µ—Ä–∏—Ç–µ –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫—É');
            log('2. –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ 1');
            log('3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã (–∫–æ—Ä–∑–∏–Ω–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è)');
            log('4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å "–û–±—Å—É–¥–∏—Ç—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"');
            log('5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—á–∏—Å—Ç–∏–ª–∏—Å—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö');
            log('');
            updateCurrentState();
        });
    </script>
</body>
</html>