<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—á–∏—Å—Ç–∫–∏ –°–î–≠–ö</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .test-button:hover { background: #005a8c; }
        .status { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .hidden-fields { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –°–î–≠–ö</h1>
    
    <div class="test-section">
        <h3>–°–∏–º—É–ª—è—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–∫–∞–∑–∞</h3>
        
        <div class="hidden-fields">
            <h4>–°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è (–∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —á–µ–∫–∞—É—Ç–µ):</h4>
            <input type="hidden" id="cdek-selected-point-code" value="MSK123">
            <input type="hidden" id="cdek-selected-point-data" value='{"code":"MSK123","name":"–ü–í–ó –¢–µ—Å—Ç"}'>
            <input type="hidden" id="cdek-delivery-cost" value="366">
            <input type="hidden" id="cdek-delivery-type" value="cdek">
            
            <div>
                <strong>–ö–æ–¥ –ø—É–Ω–∫—Ç–∞:</strong> <span id="show-point-code">MSK123</span><br>
                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> <span id="show-cost">366</span> —Ä—É–±.<br>
                <strong>–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> <span id="show-type">cdek</span>
            </div>
        </div>
        
        <div class="status info" id="current-status">
            üì¶ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ (366 —Ä—É–±.)
        </div>
    </div>
    
    <div class="test-section">
        <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
        
        <button class="test-button" onclick="testPickupSwitch()">
            üìç –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑
        </button>
        
        <button class="test-button" onclick="testManagerSwitch()">
            üìû –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        </button>
        
        <button class="test-button" onclick="testCdekSwitch()">
            üöö –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –°–î–≠–ö
        </button>
        
        <button class="test-button" onclick="resetToInitial()">
            üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
        </button>
    </div>
    
    <div class="test-section">
        <h3>üìä –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
        <div id="test-log" style="background: #f8f9fa; padding: 10px; height: 300px; overflow-y: scroll; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        // –°–∏–º—É–ª—è—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞ cdek_ajax –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.cdek_ajax = {
            ajax_url: '/wp-admin/admin-ajax.php',
            nonce: 'test_nonce_123'
        };
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('test-log');
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateDisplay() {
            document.getElementById('show-point-code').textContent = 
                document.getElementById('cdek-selected-point-code').value || '(–ø—É—Å—Ç–æ)';
            document.getElementById('show-cost').textContent = 
                document.getElementById('cdek-delivery-cost').value || '0';
            document.getElementById('show-type').textContent = 
                document.getElementById('cdek-delivery-type').value || '(–Ω–µ —É–∫–∞–∑–∞–Ω)';
            
            const cost = document.getElementById('cdek-delivery-cost').value;
            const type = document.getElementById('cdek-delivery-type').value;
            
            let statusText = '';
            let statusClass = '';
            
            if (type === 'pickup') {
                statusText = 'üìç –°–∞–º–æ–≤—ã–≤–æ–∑ –∞–∫—Ç–∏–≤–µ–Ω (–ë–µ—Å–ø–ª–∞—Ç–Ω–æ)';
                statusClass = 'success';
            } else if (type === 'manager') {
                statusText = 'üìû –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –∞–∫—Ç–∏–≤–Ω–æ (–ë–µ—Å–ø–ª–∞—Ç–Ω–æ)';
                statusClass = 'success';
            } else if (type === 'cdek' && cost > 0) {
                statusText = `üöö –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ (${cost} —Ä—É–±.)`;
                statusClass = 'info';
            } else {
                statusText = '‚ùì –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ';
                statusClass = 'error';
            }
            
            const statusDiv = document.getElementById('current-status');
            statusDiv.textContent = statusText;
            statusDiv.className = `status ${statusClass}`;
        }
        
        function clearAllCdekData() {
            log('üßπ –û—á–∏—â–∞–µ–º –í–°–ï –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö...');
            
            document.getElementById('cdek-selected-point-code').value = '';
            document.getElementById('cdek-selected-point-data').value = '';
            document.getElementById('cdek-delivery-cost').value = '0';
            
            log('‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—á–∏—â–µ–Ω—ã');
            
            // –°–∏–º—É–ª—è—Ü–∏—è AJAX –∑–∞–ø—Ä–æ—Å–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
            log('üì° –û—Ç–ø—Ä–∞–≤–∫–∞ AJAX –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–µ—Å—Å–∏–∏...');
            setTimeout(() => {
                log('‚úÖ –°–µ—Å—Å–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—á–∏—â–µ–Ω–∞ (—Å–∏–º—É–ª—è—Ü–∏—è)');
                updateDisplay();
            }, 100);
        }
        
        function testPickupSwitch() {
            log('üè™ === –¢–ï–°–¢: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑ ===');
            
            // –®–∞–≥ 1: –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö
            clearAllCdekData();
            
            // –®–∞–≥ 2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø —Å–∞–º–æ–≤—ã–≤–æ–∑
            setTimeout(() => {
                document.getElementById('cdek-delivery-type').value = 'pickup';
                log('üìç –¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: —Å–∞–º–æ–≤—ã–≤–æ–∑');
                
                // –®–∞–≥ 3: –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateDisplay();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const pointCode = document.getElementById('cdek-selected-point-code').value;
                const cost = document.getElementById('cdek-delivery-cost').value;
                
                if (pointCode === '' && cost === '0') {
                    log('‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –î–∞–Ω–Ω—ã–µ –°–î–≠–ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω—ã');
                } else {
                    log('‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: –û—Å—Ç–∞–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö');
                    log(`   - –ö–æ–¥ –ø—É–Ω–∫—Ç–∞: "${pointCode}" (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ)`);
                    log(`   - –°—Ç–æ–∏–º–æ—Å—Ç—å: "${cost}" (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)`);
                }
            }, 200);
        }
        
        function testManagerSwitch() {
            log('üìû === –¢–ï–°–¢: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ ===');
            
            // –®–∞–≥ 1: –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö
            clearAllCdekData();
            
            // –®–∞–≥ 2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø –º–µ–Ω–µ–¥–∂–µ—Ä
            setTimeout(() => {
                document.getElementById('cdek-delivery-type').value = 'manager';
                log('üìû –¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º');
                
                // –®–∞–≥ 3: –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateDisplay();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const pointCode = document.getElementById('cdek-selected-point-code').value;
                const cost = document.getElementById('cdek-delivery-cost').value;
                
                if (pointCode === '' && cost === '0') {
                    log('‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –î–∞–Ω–Ω—ã–µ –°–î–≠–ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω—ã');
                } else {
                    log('‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: –û—Å—Ç–∞–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö');
                    log(`   - –ö–æ–¥ –ø—É–Ω–∫—Ç–∞: "${pointCode}" (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ)`);
                    log(`   - –°—Ç–æ–∏–º–æ—Å—Ç—å: "${cost}" (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)`);
                }
            }, 200);
        }
        
        function testCdekSwitch() {
            log('üöö === –¢–ï–°–¢: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –°–î–≠–ö ===');
            
            document.getElementById('cdek-delivery-type').value = 'cdek';
            document.getElementById('cdek-selected-point-code').value = 'MSK456';
            document.getElementById('cdek-selected-point-data').value = '{"code":"MSK456","name":"–ù–æ–≤—ã–π –ü–í–ó"}';
            document.getElementById('cdek-delivery-cost').value = '450';
            
            log('üöö –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫–∏');
            log('   - –ö–æ–¥ –ø—É–Ω–∫—Ç–∞: MSK456');
            log('   - –°—Ç–æ–∏–º–æ—Å—Ç—å: 450 —Ä—É–±.');
            
            updateDisplay();
            log('‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
        }
        
        function resetToInitial() {
            log('üîÑ === –°–ë–†–û–° –ö –ù–ê–ß–ê–õ–¨–ù–û–ú–£ –°–û–°–¢–û–Ø–ù–ò–Æ ===');
            
            document.getElementById('cdek-selected-point-code').value = 'MSK123';
            document.getElementById('cdek-selected-point-data').value = '{"code":"MSK123","name":"–ü–í–ó –¢–µ—Å—Ç"}';
            document.getElementById('cdek-delivery-cost').value = '366';
            document.getElementById('cdek-delivery-type').value = 'cdek';
            
            updateDisplay();
            log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±—Ä–æ—à–µ–Ω–æ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            log('üéØ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:');
            log('   1. –°–Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –°–î–≠–ö –¥–æ—Å—Ç–∞–≤–∫—É (366 —Ä—É–±.)');
            log('   2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑ –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞');
            log('   3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –°–î–≠–ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω—ã');
            log('   4. –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ç—å 0, –∫–æ–¥ –ø—É–Ω–∫—Ç–∞ - –ø—É—Å—Ç—ã–º');
            log('');
            updateDisplay();
        });
    </script>
</body>
</html>