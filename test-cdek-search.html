<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .search-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 6px; }
        .city-card { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #007cba; }
        .city-name { font-weight: bold; color: #007cba; font-size: 16px; }
        .city-info { margin: 5px 0; font-size: 14px; color: #666; }
        .test-button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #005a8c; }
        .test-button:disabled { background: #ccc; cursor: not-allowed; }
        .results { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 6px; max-height: 400px; overflow-y: auto; }
        .log { background: #f1f3f4; padding: 15px; font-family: monospace; font-size: 12px; height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0; }
        .status { padding: 8px 12px; border-radius: 4px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –°–î–≠–ö</h1>
        <p>–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∏—Å–∫–∞ –≤ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö —Ç–∏–ø–∞ –ú–∞–≥–∞–¥–∞–Ω, –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–∏—Å–∫–æ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é.</p>
        
        <div class="grid">
            <div class="search-section">
                <h3>üéØ –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –≥–æ—Ä–æ–¥–∞</h3>
                <p>–ì–æ—Ä–æ–¥–∞, –≥–¥–µ —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–∏—Å–∫–æ–º –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö:</p>
                
                <div class="city-card">
                    <div class="city-name">–ú–∞–≥–∞–¥–∞–Ω</div>
                    <div class="city-info">–°–î–≠–ö –∫–æ–¥: 314 | –†–µ–≥–∏–æ–Ω: –ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</div>
                    <button class="test-button" onclick="testCity('–ú–∞–≥–∞–¥–∞–Ω', 314)">üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</button>
                </div>
                
                <div class="city-card">
                    <div class="city-name">–ê–Ω–∞–¥—ã—Ä—å</div>
                    <div class="city-info">–°–î–≠–ö –∫–æ–¥: 475 | –†–µ–≥–∏–æ–Ω: –ß—É–∫–æ—Ç—Å–∫–∏–π –ê–û</div>
                    <button class="test-button" onclick="testCity('–ê–Ω–∞–¥—ã—Ä—å', 475)">üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</button>
                </div>
                
                <div class="city-card">
                    <div class="city-name">–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫-–ö–∞–º—á–∞—Ç—Å–∫–∏–π</div>
                    <div class="city-info">–°–î–≠–ö –∫–æ–¥: 246 | –†–µ–≥–∏–æ–Ω: –ö–∞–º—á–∞—Ç—Å–∫–∏–π –∫—Ä–∞–π</div>
                    <button class="test-button" onclick="testCity('–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫-–ö–∞–º—á–∞—Ç—Å–∫–∏–π', 246)">üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</button>
                </div>
                
                <div class="city-card">
                    <div class="city-name">–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫</div>
                    <div class="city-info">–°–î–≠–ö –∫–æ–¥: 243 | –†–µ–≥–∏–æ–Ω: –°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</div>
                    <button class="test-button" onclick="testCity('–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫', 243)">üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</button>
                </div>
                
                <div class="city-card">
                    <div class="city-name">–ú–æ—Å–∫–≤–∞ (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)</div>
                    <div class="city-info">–°–î–≠–ö –∫–æ–¥: 44 | –†–µ–≥–∏–æ–Ω: –≥. –ú–æ—Å–∫–≤–∞</div>
                    <button class="test-button" onclick="testCity('–ú–æ—Å–∫–≤–∞', 44)">üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</button>
                </div>
            </div>
            
            <div class="search-section">
                <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h3>
                <div id="test-status" class="status info">
                    –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                </div>
                
                <div id="test-results" class="results">
                    <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –∑–¥–µ—Å—å...</p>
                </div>
                
                <h4>üìù –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h4>
                <div id="test-log" class="log">
                    –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω –∑–¥–µ—Å—å...
                </div>
                
                <button class="test-button" onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
            </div>
        </div>
        
        <div class="search-section">
            <h3>üõ†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–µ—Å—Ç</h3>
            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="custom-city" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; flex: 1; min-width: 200px;">
                <input type="number" id="custom-code" placeholder="–°–î–≠–ö –∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 150px;">
                <button class="test-button" onclick="testCustomCity()">üîç –ù–∞–π—Ç–∏ –ø—É–Ω–∫—Ç—ã</button>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('test-log');
            const typeIcon = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            }[type] || '‚ÑπÔ∏è';
            
            logDiv.innerHTML += `[${timestamp}] ${typeIcon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('test-status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function displayResults(city, cdekCode, results) {
            const resultsDiv = document.getElementById('test-results');
            
            let html = `<h4>üèôÔ∏è ${city} (–∫–æ–¥: ${cdekCode || '–Ω–µ —É–∫–∞–∑–∞–Ω'})</h4>`;
            
            if (!results || results.length === 0) {
                html += `<div class="error">‚ùå –ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>`;
                html += `<p><strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</strong></p>`;
                html += `<ul>`;
                html += `<li>–í –≥–æ—Ä–æ–¥–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ—Ç –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö</li>`;
                html += `<li>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –°–î–≠–ö –∫–æ–¥ –≥–æ—Ä–æ–¥–∞</li>`;
                html += `<li>–ü—Ä–æ–±–ª–µ–º—ã —Å API –∑–∞–ø—Ä–æ—Å–æ–º</li>`;
                html += `<li>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞</li>`;
                html += `</ul>`;
            } else {
                html += `<div class="success">‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø—É–Ω–∫—Ç–æ–≤: ${results.length}</div>`;
                html += `<div style="margin-top: 15px;">`;
                
                results.slice(0, 5).forEach((point, index) => {
                    html += `<div style="background: white; padding: 10px; margin: 5px 0; border: 1px solid #e0e0e0; border-radius: 4px;">`;
                    html += `<strong>${point.name || '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏'}</strong><br>`;
                    html += `<small style="color: #666;">–ö–æ–¥: ${point.code || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</small><br>`;
                    if (point.location && point.location.address) {
                        html += `<small style="color: #666;">–ê–¥—Ä–µ—Å: ${point.location.address}</small>`;
                    }
                    html += `</div>`;
                });
                
                if (results.length > 5) {
                    html += `<p><em>... –∏ –µ—â–µ ${results.length - 5} –ø—É–Ω–∫—Ç–æ–≤</em></p>`;
                }
                
                html += `</div>`;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function testCity(cityName, cdekCode) {
            log(`üîç === –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ì–û–†–û–î–ê: ${cityName} ===`);
            log(`–ù–∞–∑–≤–∞–Ω–∏–µ: ${cityName}`);
            log(`–°–î–≠–ö –∫–æ–¥: ${cdekCode}`);
            
            updateStatus(`üîç –ü–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤ –≤ –≥–æ—Ä–æ–¥–µ ${cityName}...`, 'info');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤–æ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞
            const buttons = document.querySelectorAll('.test-button');
            buttons.forEach(btn => btn.disabled = true);
            
            // –°–∏–º—É–ª—è—Ü–∏—è AJAX –∑–∞–ø—Ä–æ—Å–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
            log(`üì° –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API –°–î–≠–ö...`);
            log(`–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: city="${cityName}", city_code=${cdekCode}`);
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            setTimeout(() => {
                let simulatedResults = [];
                
                if (cityName === '–ú–æ—Å–∫–≤–∞') {
                    // –î–ª—è –ú–æ—Å–∫–≤—ã —Å–∏–º—É–ª–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    simulatedResults = [
                        { code: 'MSK1', name: '–°–î–≠–ö - –ú–æ—Å–∫–≤–∞ (–¶–µ–Ω—Ç—Ä)', location: { address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, –¥. 1' }},
                        { code: 'MSK2', name: '–°–î–≠–ö - –ú–æ—Å–∫–≤–∞ (–°–µ–≤–µ—Ä)', location: { address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è, –¥. 10' }},
                        { code: 'MSK3', name: '–°–î–≠–ö - –ú–æ—Å–∫–≤–∞ (–Æ–≥)', location: { address: '–≥. –ú–æ—Å–∫–≤–∞, –í–∞—Ä—à–∞–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, –¥. 20' }}
                    ];
                    log(`‚úÖ API –≤–µ—Ä–Ω—É–ª ${simulatedResults.length} –ø—É–Ω–∫—Ç–æ–≤ –¥–ª—è –ú–æ—Å–∫–≤—ã`);
                    updateStatus(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${simulatedResults.length} –ø—É–Ω–∫—Ç–æ–≤ –≤ –≥–æ—Ä–æ–¥–µ ${cityName}`, 'success');
                } else {
                    // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å–∏–º—É–ª–∏—Ä—É–µ–º –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Å –ú–∞–≥–∞–¥–∞–Ω–æ–º)
                    log(`‚ùå API –≤–µ—Ä–Ω—É–ª 0 –ø—É–Ω–∫—Ç–æ–≤ –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);
                    log(`üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:`);
                    log(`   - –í –≥–æ—Ä–æ–¥–µ –Ω–µ—Ç –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö`);
                    log(`   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–∞–ø—Ä–æ—Å–∞ (city_code vs city)`);
                    log(`   - –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä (region_code)`);
                    updateStatus(`‚ùå –ü—É–Ω–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –≥–æ—Ä–æ–¥–µ ${cityName}`, 'error');
                }
                
                displayResults(cityName, cdekCode, simulatedResults);
                
                // –í–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ –∫–Ω–æ–ø–∫–∏
                buttons.forEach(btn => btn.disabled = false);
                
                log(`üèÅ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ ${cityName} –∑–∞–≤–µ—Ä—à–µ–Ω–æ`);
                log(``);
                
            }, 1500); // –°–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –∑–∞–ø—Ä–æ—Å–∞
        }
        
        function testCustomCity() {
            const cityName = document.getElementById('custom-city').value.trim();
            const cdekCode = document.getElementById('custom-code').value.trim();
            
            if (!cityName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞');
                return;
            }
            
            testCity(cityName, cdekCode || null);
        }
        
        function clearResults() {
            document.getElementById('test-log').innerHTML = '';
            document.getElementById('test-results').innerHTML = '<p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –∑–¥–µ—Å—å...</p>';
            updateStatus('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'info');
            log('üóëÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            log('üéØ –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö –∑–∞–≥—Ä—É–∂–µ–Ω');
            log('üìã –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–∏—Å–∫–æ–º –≤ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö');
            log('üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ú–æ—Å–∫–≤—É, –∑–∞—Ç–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –≥–æ—Ä–æ–¥–∞');
            log('');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
            document.getElementById('custom-city').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    testCustomCity();
                }
            });
        });
    </script>
</body>
</html>