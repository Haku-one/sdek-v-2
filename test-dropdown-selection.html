<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 6px; }
        .input-field { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; margin: 10px 0; }
        .dropdown { border: 1px solid #007cba; border-radius: 4px; max-height: 200px; overflow-y: auto; background: white; position: relative; }
        .dropdown-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .dropdown-item:hover { background: #f0f8ff; }
        .dropdown-item:last-child { border-bottom: none; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .log { background: #f1f3f4; padding: 15px; font-family: monospace; font-size: 12px; height: 250px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0; }
        .test-button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #005a8c; }
        .scenario { background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid #007cba; }
        .scenario-title { font-weight: bold; color: #007cba; margin-bottom: 10px; }
        .flags-display { background: #e9ecef; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 13px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç –¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –≥–æ—Ä–æ–¥–∞ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ DaData.</p>
        
        <div class="test-section">
            <h3>üéØ –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—è –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞</h3>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ -->
            <input type="hidden" id="cdek-delivery-type" value="cdek">
            
            <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –≥–æ—Ä–æ–¥–∞ -->
            <input type="text" id="billing_address_1" class="input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞...">
            
            <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ -->
            <div id="address-suggestions" class="dropdown" style="display: none;">
                <div class="dropdown-item" data-city="–ú–æ—Å–∫–≤–∞" data-cdek-code="44">
                    <strong>–ú–æ—Å–∫–≤–∞</strong><br>
                    <small>–≥. –ú–æ—Å–∫–≤–∞ ‚Ä¢ –°–î–≠–ö –∫–æ–¥: 44</small>
                </div>
                <div class="dropdown-item" data-city="–ú–∞–≥–∞–¥–∞–Ω" data-cdek-code="314">
                    <strong>–ú–∞–≥–∞–¥–∞–Ω</strong><br>
                    <small>–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å ‚Ä¢ –°–î–≠–ö –∫–æ–¥: 314</small>
                </div>
                <div class="dropdown-item" data-city="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥" data-cdek-code="137">
                    <strong>–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</strong><br>
                    <small>–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ ‚Ä¢ –°–î–≠–ö –∫–æ–¥: 137</small>
                </div>
                <div class="dropdown-item" data-city="–ê–Ω–∞–¥—ã—Ä—å" data-cdek-code="475">
                    <strong>–ê–Ω–∞–¥—ã—Ä—å</strong><br>
                    <small>–ß—É–∫–æ—Ç—Å–∫–∏–π –ê–û ‚Ä¢ –°–î–≠–ö –∫–æ–¥: 475</small>
                </div>
            </div>
            
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–∏—Å–∫–∞ -->
            <div id="search-status" class="status info">
                –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ –ø–æ–ª–µ –≤—ã—à–µ
            </div>
            
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ -->
            <div id="cdek-points-count" style="padding: 10px; background: #f8f9fa; border-radius: 4px; margin: 10px 0;">
                –í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –≤ –ø–æ–ª–µ "–ê–¥—Ä–µ—Å" –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏
            </div>
            
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ -->
            <div class="flags-display">
                <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤:</strong><br>
                <span id="flag-dropdown">citySelectedFromDropdown: false</span><br>
                <span id="flag-city">lastDropdownSelectedCity: null</span>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</h3>
            
            <div class="scenario">
                <div class="scenario-title">–°—Ü–µ–Ω–∞—Ä–∏–π 1: –í–≤–æ–¥ –≥–æ—Ä–æ–¥–∞ –≤—Ä—É—á–Ω—É—é (–ë–ï–ó –≤—ã–±–æ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞)</div>
                <p>1. –í–≤–µ–¥–∏—Ç–µ "–ú–æ—Å" –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞</p>
                <p>2. –ù–ï –≤—ã–±–∏—Ä–∞–π—Ç–µ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞</p>
                <p><strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> ‚ùå –ü–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö –ù–ï –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è</p>
                <button class="test-button" onclick="testManualInput()">üß™ –¢–µ—Å—Ç —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞</button>
            </div>
            
            <div class="scenario">
                <div class="scenario-title">–°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞</div>
                <p>1. –í–≤–µ–¥–∏—Ç–µ "–ú–æ—Å" –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞</p>
                <p>2. –í—ã–±–µ—Ä–∏—Ç–µ "–ú–æ—Å–∫–≤–∞" –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞</p>
                <p><strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> ‚úÖ –ü–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è</p>
                <button class="test-button" onclick="testDropdownSelection()">üß™ –¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞</button>
            </div>
            
            <div class="scenario">
                <div class="scenario-title">–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞</div>
                <p>1. –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏–∑ —Å–ø–∏—Å–∫–∞</p>
                <p>2. –ò–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –≤—Ä—É—á–Ω—É—é</p>
                <p><strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> ‚ùå –ü–æ–∏—Å–∫ –¥–æ–ª–∂–µ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è</p>
                <button class="test-button" onclick="testCityChange()">üß™ –¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìù –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h3>
            <div id="test-log" class="log">
                –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω –∑–¥–µ—Å—å...
            </div>
            <button class="test-button" onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
    </div>

    <script>
        // –§–ª–∞–≥–∏ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
        window.citySelectedFromDropdown = false;
        window.lastDropdownSelectedCity = null;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('test-log');
            const typeIcon = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            }[type] || '‚ÑπÔ∏è';
            
            logDiv.innerHTML += `[${timestamp}] ${typeIcon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
            
            updateFlagsDisplay();
        }
        
        function updateFlagsDisplay() {
            document.getElementById('flag-dropdown').textContent = 
                `citySelectedFromDropdown: ${window.citySelectedFromDropdown}`;
            document.getElementById('flag-city').textContent = 
                `lastDropdownSelectedCity: ${window.lastDropdownSelectedCity || 'null'}`;
        }
        
        function updateSearchStatus(message, type = 'info') {
            const statusDiv = document.getElementById('search-status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function updateCdekPointsStatus(message) {
            const cdekDiv = document.getElementById('cdek-points-count');
            cdekDiv.innerHTML = message;
        }
        
        function simulateCdekSearch(city) {
            if (window.citySelectedFromDropdown && window.lastDropdownSelectedCity === city) {
                log(`‚úÖ –ì–æ—Ä–æ–¥ –±—ã–ª –≤—ã–±—Ä–∞–Ω –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ - –ø–æ–∏—Å–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω`, 'success');
                updateSearchStatus(`‚úÖ –ü–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö –¥–ª—è –≥–æ—Ä–æ–¥–∞: ${city}`, 'success');
                updateCdekPointsStatus(`üîç –ü–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –≤ –≥–æ—Ä–æ–¥–µ ${city}...`);
                
                // –°–∏–º—É–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
                setTimeout(() => {
                    const pointsCount = Math.floor(Math.random() * 10) + 1;
                    updateCdekPointsStatus(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${pointsCount} –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –≤ –≥–æ—Ä–æ–¥–µ ${city}`);
                    log(`üéØ –ù–∞–π–¥–µ–Ω–æ ${pointsCount} –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –°–î–≠–ö`, 'success');
                }, 1000);
                
                return true;
            } else {
                log(`‚ö†Ô∏è –ì–æ—Ä–æ–¥ –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é, –Ω–æ –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ - –ø–æ–∏—Å–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`, 'warning');
                updateSearchStatus(`‚ùå –ü–æ–∏—Å–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏–∑ —Å–ø–∏—Å–∫–∞`, 'error');
                updateCdekPointsStatus(`üìå <strong>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞</strong> –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –°–î–≠–ö`);
                return false;
            }
        }
        
        function selectCityFromDropdown(cityName, cdekCode) {
            log(`üéØ –ì–æ—Ä–æ–¥ –≤—ã–±—Ä–∞–Ω –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ DaData: ${cityName} - –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–∏—Å–∫ –°–î–≠–ö`, 'success');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥–∏
            window.citySelectedFromDropdown = true;
            window.lastDropdownSelectedCity = cityName;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('billing_address_1').value = cityName;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
            document.getElementById('address-suggestions').style.display = 'none';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤
            simulateCdekSearch(cityName);
        }
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function testManualInput() {
            log('üß™ === –¢–ï–°–¢ 1: –†—É—á–Ω–æ–π –≤–≤–æ–¥ –≥–æ—Ä–æ–¥–∞ ===');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏
            window.citySelectedFromDropdown = false;
            window.lastDropdownSelectedCity = null;
            
            // –í–≤–æ–¥–∏–º –≥–æ—Ä–æ–¥ –≤—Ä—É—á–Ω—É—é
            const input = document.getElementById('billing_address_1');
            input.value = '–ú–æ—Å';
            
            log('‚å®Ô∏è –í–≤–æ–∂—É "–ú–æ—Å" –≤ –ø–æ–ª–µ –∞–¥—Ä–µ—Å–∞');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –ø–æ–ø—ã—Ç–∫—É –ø–æ–∏—Å–∫–∞
            const searchAllowed = simulateCdekSearch('–ú–æ—Å');
            
            if (!searchAllowed) {
                log('‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –ü–æ–∏—Å–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
            } else {
                log('‚ùå –¢–ï–°–¢ –ü–†–û–í–ê–õ–ï–ù: –ü–æ–∏—Å–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã–ª –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è', 'error');
            }
        }
        
        function testDropdownSelection() {
            log('üß™ === –¢–ï–°–¢ 2: –í—ã–±–æ—Ä –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ ===');
            
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
            document.getElementById('address-suggestions').style.display = 'block';
            log('üìã –ü–æ–∫–∞–∑—ã–≤–∞—é –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –≤—ã–±–æ—Ä –ú–æ—Å–∫–≤—ã
            setTimeout(() => {
                selectCityFromDropdown('–ú–æ—Å–∫–≤–∞', '44');
                log('‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –ü–æ–∏—Å–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞', 'success');
            }, 500);
        }
        
        function testCityChange() {
            log('üß™ === –¢–ï–°–¢ 3: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ ===');
            
            // –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–∏—Ä–∞–µ–º –≥–æ—Ä–æ–¥ –∏–∑ —Å–ø–∏—Å–∫–∞
            selectCityFromDropdown('–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '137');
            
            // –ß–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –∏–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ
            setTimeout(() => {
                log('‚úèÔ∏è –ò–∑–º–µ–Ω—è—é —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ —Å "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥" –Ω–∞ "–°–ø–±"');
                
                const input = document.getElementById('billing_address_1');
                input.value = '–°–ø–±';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
                if (window.lastDropdownSelectedCity && window.lastDropdownSelectedCity !== '–°–ø–±') {
                    window.citySelectedFromDropdown = false;
                    log('üîÑ –°–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ - –≥–æ—Ä–æ–¥ –∏–∑–º–µ–Ω–∏–ª—Å—è', 'warning');
                }
                
                // –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫
                const searchAllowed = simulateCdekSearch('–°–ø–±');
                
                if (!searchAllowed) {
                    log('‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –ü–æ–∏—Å–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è', 'success');
                } else {
                    log('‚ùå –¢–ï–°–¢ –ü–†–û–í–ê–õ–ï–ù: –ü–æ–∏—Å–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã–ª –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è', 'error');
                }
                
            }, 2000);
        }
        
        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
            updateFlagsDisplay();
            log('üóëÔ∏è –õ–æ–≥ –æ—á–∏—â–µ–Ω');
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('DOMContentLoaded', function() {
            updateFlagsDisplay();
            log('üéØ –¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω');
            log('üí° –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤ –°–î–≠–ö –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –≥–æ—Ä–æ–¥–∞ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞');
            log('');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –≤ –ø–æ–ª–µ –∞–¥—Ä–µ—Å–∞
            document.getElementById('billing_address_1').addEventListener('input', function() {
                const city = this.value.trim();
                
                if (city.length >= 2) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ 2+ —Å–∏–º–≤–æ–ª–∞
                    document.getElementById('address-suggestions').style.display = 'block';
                    log(`üîç –í–≤–æ–¥: "${city}" - –ø–æ–∫–∞–∑—ã–≤–∞—é –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫`);
                } else {
                    // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏
                    document.getElementById('address-suggestions').style.display = 'none';
                    if (city.length === 0) {
                        window.citySelectedFromDropdown = false;
                        window.lastDropdownSelectedCity = null;
                        log('üóëÔ∏è –ü–æ–ª–µ –æ—á–∏—â–µ–Ω–æ - —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞');
                        updateCdekPointsStatus('–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –≤ –ø–æ–ª–µ "–ê–¥—Ä–µ—Å" –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏');
                    }
                }
                
                updateFlagsDisplay();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    const cityName = this.dataset.city;
                    const cdekCode = this.dataset.cdekCode;
                    selectCityFromDropdown(cityName, cdekCode);
                });
            });
        });
    </script>
</body>
</html>